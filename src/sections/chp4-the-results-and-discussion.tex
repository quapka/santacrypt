\chapter{The results on real cards and discussion}\label{chp:results}

In this chapter we will utilize the attacks discussed in the chapter~\ref{chp:state-of-the-art} and the testing framework JavaCard Vulnerability Scanner presented in the previous chapter and analyze a set of real JavaCards. Aquiring a large number of distinct JavaCards is not an easy task (as they are usually hard to come by in small $< 1000$ quantities), however, thanks to the joined work of the members of CRoCS laboratory~\cite{crocsweb} we had an interesting variety of JavaCards available for testing. The tested JavaCard were fabricated between the years 2011 a 2017 and the operating systems on these cards were released between the years 2010 and 2018. The list of the cards can be seen in~\ref{tab:card-list}.

\begin{table}[htb]
    \hfill
    \parbox[t][][t]{.45\linewidth}{
        \centering
        \input{src/tables/card-list.tex}
    }
    \hfill
    \parbox[t][][t]{.45\linewidth}{
        \centering
        \begin{tabular}{@{}ll@{}}
            \toprule
                mark & stage result \\
            \midrule
                \passmark & passed \\
                \failmark & failed \\
                \skipmark & skipped\\
            \bottomrule
        \end{tabular}
        \caption{The meaning of the different marks in the following tables.\label{tab:stage-legend}}
    }
    % \end{table}
\end{table}
\footnotetext{GP stands for GlobalPlatform~\cite{globalplatform} and the number refers to the version of the specifications the card adheres to.}


        The JavaCard Vulnerability Scanner currently tests only attacks, that have been published previously. Nevertheless, during the analysis we have indentified a few cards, which are still vulnerable to some of the attacks. We will continue to study the consequences of those attacks on the affected cards and disclose the results to their respective manufactures if necessary.


    \section{Results of the individual attacks}
        % Before we dive into the results of particular attacks we will

        % TODO Some cards are doubled explain. Card B is got blocked during the analysis?
        In the following sections we need to often mention, for which SDK version we have obtained the results (as they differ significantly). To ease the work for the reader we will not always list all the versions, but write only their range. For that purpose we will use their natural chronological ordering.% (2.1.1. $<$ 2.1.2. $<$ 2.2.1. $<$ 2.2.2. $<$ 3.0.3 $<$ 3.0.4. $)

        We have investigated the behaviour of eleven distinct physical JavaCards and we have performed eight attacks on most of them, therefore we have collected a lot of results. In the following subsections we will cover the attacks one by one and show the most successful attacks. We point out, that when we talk about an attack or stage being \textit{successful} we take the perspective of the adversary and not the defender. The legend for the tables, that we will be presented is in the table~\ref{tab:stage-legend}.

\subsection{\texttt{arraycopy}}\label{subsec:result-arraycopy}
            As the reader can see in table~\ref{tab:best-arraycopy} only a single card was vulnerable to this attack. For every SDK version the cards \Cnewcard, \Fcard, \Gcard, \Hcard, \Inewcard prevented already the load of the malicious CAP \vulnscap. Each responded with the status word \swwrongdata, except the \Cnewcard, which has failed with \swunknown and \Inewcard with \swwrongdata. The \vulnscap could not have been installed on \Icard, \Ccard and the status word \swconditionsnotsatisfied was returned.
            % \Inewcard also acted unlike \Icard with the load failing with \mintinline{bash}{0x6A80 - WRONG_DATA}.
            % \import{src/tables/subtables}{best-arraycopy.tex}
            % FIXME card stopped working 97 JCRE muteing card

            However, not all cards have failed the installation of \vulnscap. With SDK 2.2.1 the card \Dcard let both CAP files be installed, but returned \swclanotsupported when selecting applet to execute the first send stage. Then, during the execution of the first send stage the card stopped working with the error \scardenottransacted. After several minutes the card started to work again and both applets could be deleted with GlobalPlatformPro using the \mintinline{bash}{--delete} flag.

            For the SDK versions 3.0.5u1, 3.0.5.u2 and 3.0.5u3 the card \Acard did fail with \swwrongdata when loading the \appletscap, but for 2.2.1.--3.0.4. SDKs everything was loaded and installed properly, but the send stages failed with \swunknown. Neither of the applets could be uninstalled afterwards and the uninstall command returns \swconditionsnotsatisfied.

            Finally, the most interesting behaviour was obtained with the card \Jcard. For SDKs 3.0.5u1, 3.0.5u2, 3.0.5u3 the load of the file \appletscap failed with \jerror. But for the rest of the SDKs the attack succeeded. All of the send stages passed and the only issue was to uninstall the \appletscap file --- the uninstallation failed with \swconditionsnotsatisfied. Therefore multiple invocation can fill the JavaCards memory and prevent further installations. However, the attack works and according to~\cite{se:oracle:part1} it should allow arbitrary read and write access.


            % The worst of all the cards is the card \Jcard. 
            %Anew
            %Ended same
            %    Anew-jc221
            %    Anew-jc222
            %    Anew-jc303
            %    Anew-jc304
            %    all install succeeded
            %    both applets are installed, however, cannot be uninstalled.
            %    all sends ended with 6f00 - no SW_UKNOWN, no precise diagnosis
            %    all uninstalls failed with 6985, SW_CONDITIONS_NOT_SATISFIED

            %Ended same
            %    Anew-jc305u1
            %    Anew-jc305u2
            %    Anew-jc305u3
            %    applets.cap cannot be install
            %        LOAD failed: 0x6A80 (Wrong data/incorrect values in data)
            %    however, uninstalling the vulns.new.cap can be uninstalled

            %%D - TODO failed during jc221
            %%E - TODO
            %F - all same
            %    LOAD failed: 0x6A80 (Wrong data/incorrect values in data)
            %G - all same
            %    LOAD failed: 0x6A80 (Wrong data/incorrect values in data
            %H - all same
            %    LOAD failed: 0x6A80 (Wrong data/incorrect values in data

            %I - all same
            %    INSTALL [for load] failed: 0x6985 (Conditions of use not satisfied
            %C for all sdks the vulns.new.cap cannot be installed
            %    INSTALL [for load] failed: 0x6985 (Conditions of use not satisfied)

            %Cnew for all sdks the vulns.new.cap cannot be installed
            %    LOAD failed: 0x6F00

            %Inew - all same LOAD failed: 0x6A80 (Wrong data/incorrect values in data
            %J
            %    most different applets.cap
            %    jc221,jc222,jc303,jc304 - DELETE failed: 0x6985 (Conditions of use not satisfied)
%jc305u1 jc305u2 jc305u3 - LOAD failed: 0x6438 applets.cap

            \subsection{\texttt{arrayops}}
            % TODO figure out, where is this frooom
            This attack can only be built for the 3.0.5u1--3.0.5u3 SDK versions. The results of the attack do differ across the range of the cards (see the table~\ref{tab:best-arrayops}), however, for fixed card the results don't differ across the SDKs.
            
            The load of \vulnscap failed with the status word \shortswwrongdata for the cards \Fcard, \Gcard, \Hcard and \Inewcard with status word \shortswunknown for \Cnewcard card. For \Jcard the loading of \vulnscap returned unknown status word \mintinline{python}{0x6438}. The card \Ccard could not install \vulnscap and gave \shortswconditionsnotsatisfied error. 

            The cards \Acard and \Dcard allowed the installation of \vulnscap, but returned \shortswwrongdata during the load of \appletscap. The card \Icard exited the installation of \appletscap with \shortswconditionsnotsatisfied.


            % C all vulns.new.cap  INSTALL [for load] failed: 0x6985 (Conditions of use not satisfied
            % Cnew all vulns.new.cap load failed with 0x6f00


            % B, E no results
            % F all vulns.new.cap  LOAD failed: 0x6A80 (Wrong data/incorrect values in data
            % G all vulns.new.cap  LOAD failed: 0x6A80 (Wrong data/incorrect values in data
            % H all vulns.new.cap  LOAD failed: 0x6A80 (Wrong data/incorrect values in data
            % Inew all applets.cap LOAD failed: 0x6A80 (Wrong data/incorrect values in data

            % I all applets.cap INSTALL [for load] failed: 0x6985 (Conditions of use not satisfied

            % Anew  all applets.cap load failed wih 0x6A80 swwrongdata, vulns.new.cap uninstall ok
            % D all applets.cap  LOAD failed: 0x6A80 (Wrong data/incorrect values in data

            % J all vulns.new.cap LOAD failed: 0x6438

            % \import{src/tables/subtables}{best-arrayops.tex}
            Therefore, none of the tested cards are vulnerable to this kind of attack.

        % TODO typesett baload, bastore in code
            \subsection{\texttt{baload_bastore}}

            For SDKs 2.2.1.--3.0.5u3 the first file \vulnscap required for the attack could not have been even loaded on the cards \Fcard, \Gcard, \Hcard with status word \shortswconditionsnotsatisfied and, similarly, for the cards \Ccard, \Icard, \Inewcard, but with the word \shortswwrongdata. Contrary, the card \Cnewcard failed in the same spot for all SDKs, but with word \shortswunknown.

            The card \Acard pass the install stages and failed during the send of \texttt{PING} with \shortswunknown for 2.2.1.--3.0.4. However, for the rest of SDKs the run failed during the loading of \appletscap and gave \shortswwrongdata.

            The card \Bcard was tested only on SDK 3.0.3., for which it installed both CAP files but the first send stage failed with \shortswunknown. The card \Dcard behave in the exact same way for 2.2.1. For the rest 2.2.2.--3.0.5.u3 the CAP \appletscap was not loaded and returned \shortswwrongdata instead. The last card \Jcard also failed during loading the \appletscap file, but with unknown error \mintinline{python}{0x6438}. Finally, for the remaining SDK versions 2.2.1.--3.0.4. the \texttt{PING} instruction gave \shortswunknown. For all of the previous it holds, that if an applet was installed successfully it was also uninstalled without any issues. The best results can be observed in table~\ref{tab:best-baload_bastore}.

            % \import{src/tables/subtables}{best-baload-bastore.tex}

        % Anew jc221, jc222, jc303, jc304 installs success, first send 6F00 No precise diagnosis SW_UNKNOWN
            % jc305u1, u2, u3
            % applets.cap LOAD failed: 0x6A80 (Wrong data/incorrect values in data

        % B jc303 install ok, send 6F00 No precise diagnosis SW_UNKNOWN
        % C jc221, jc222,jc303, jc304, 305u1,u2, u3  vulns.new.cap INSTALL [for load] failed: 0x6985 (Conditions of use not satisfied

        % Cnew jc221, jc222, jc303, jc304, jc305u1u2u3
        %     vulns.new.cap LOAD failed: 0x6F00
        
        % D jc221, 
        %     first send 6F00 No precise diagnosis SW_UNKNOWN
        %   jc222, jc303, jc304, jc305u1u2u3
        %     applets.cap LOAD failed: 0x6A80 (Wrong data/incorrect values in data)

        % E nothing
        % F jc221, jc222, jc303, jc304, jc305u1u2u3
        %     vulns.new.cap LOAD failed: 0x6A80 (Wrong data/incorrect values in data

        % G jc221, jc222, jc303, jc304, jc305u1u2u3
        %     vulns.new.cap LOAD failed: 0x6A80 (Wrong data/incorrect values in data

        % H jc221, jc222, jc303, jc304, jc305u1u2u3
        %     vulns.new.cap LOAD failed: 0x6A80 (Wrong data/incorrect values in data

        % I jc221, jc222, jc303, jc304, jc305u1u2u3
        %     vulns.new.cap INSTALL [for load] failed: 0x6985 (Conditions of use not satisfied

        % Inew jc221, jc222, jc303, jc304, jc305u1u2u3
        %     vulns.new.cap INSTALL [for load] failed: 0x6985 (Conditions of use not satisfied

        % J jc305u1u2u3
        %     applets.cap LOAD failed: 0x6438 
        %   jc221, jc222, jc303, jc304
        %   first send 6F00 No precise diagnosis SW_UNKNOWN, uninstall ok

            \subsection{\texttt{nativemethod}}

            We continue with another unsuccessful attack, the best results across the cards are in the table~\ref{tab:best-nativemethod}. For all SDKs the following cards \Fcard, \Gcard, \Hcard and \Inewcard the loading of \vulnscap was prevented and the cards returned \shortswwrongdata, the card \Cnewcard failed similarly, but gave \shortswunknown. On the other hand, the card \Ccard did not allow installation of the \vulnscap with \shortswconditionsnotsatisfied. The card \Icard was tested onlyfor SDK 2.2.1., for which it failed loading the first applet in the same manner as \Ccard, but stopped working afterwards with the error \scardenottransacted.

            The cards \Acard (for SDK 3.0.5u1--3.0.5u3) and \Bcard (for SDK 3.0.4.--3.0.5u3) exited during the loading of \appletscap with \shortswwrongdata. For the rest of the SDKs the card \Acard allowed instalation of the CAP files, but returned the status word \shortswunknown during the stage \texttt{NREAD_SHORT}. On the other hand, the card \Bcard (for SDKs 2.2.1.--3.0.3.) installed both applets, but while selecting the target applet for the first send stage returned \shortswclanotsupported and the immediate send failed with \scardenottransacted, which stopped the card from working for several minutes.
            
            The card \Dcard and \Jcard were tested only with SDK 2.2.1., for which they've installed both applets, but to the stage \texttt{NREAD_SHORT} responded with \scardenottransacted and \scardwunpoweredcard respectively.
            % TODO the J card probably was block by this completely
            % Two cards stopped working.
            % \import{src/tables/subtables}{best-nativemethod.tex}

            % Anew jc305u1u2u3
                % applets.cap LOAD failed: 0x6A80 (Wrong data/incorrect values in data)

                % jc221, jc222, jc303, jc304 
                % first send 6F00 No precise diagnosis SW_UNKNOWN

            % B jc221, jc222, jc303
            %     applet select returned 6E00
            %     successful installed both
            %     SCARD_E_NOT_TRANSACTED
              % jc303, jc305u1u2u3
              %   applets.cap LOAD failed: 0x6A80 (Wrong data/incorrect values in data

            % C jc221, jc222,jc303, jc304, 305u1,u2, u3  vulns.new.cap INSTALL [for load] failed: 0x6985 (Conditions of use not satisfied

            % Cnew jc221, jc222, jc303, jc304, jc305u1u2u3
            %     vulns.new.cap  LOAD failed: 0x6F00

            % D jc221
            %     both installation has passed
            %     SCARD_E_NOT_TRANSACTED

            % E no
            % F jc221, jc222, jc303, jc304, jc305u1u2u3
            %     vulns.new.cap
            %     LOAD failed: 0x6A80 (Wrong data/incorrect values in data)

            % G jc221, jc222, jc303, jc304, jc305u1u2u3
            %     vulns.new.cap
            %     LOAD failed: 0x6A80 (Wrong data/incorrect values in data)

%             H jc221, jc222, jc303, jc304, jc305u1u2u3
%                 vulns.new.cap
%                 LOAD failed: 0x6A80 (Wrong data/incorrect values in data)

            % I   jc221
            %     INSTALL [for load] failed: 0x6985 (Conditions of use not satisfied
            %     stopped working SCARD_W_UNPOWERED_CARD

            % Inew jc221, jc222, jc303, jc304, jc305u1u2u3
            %     vulns.new.cap
            %     LOAD failed: 0x6A80 (Wrong data/incorrect values in data)

            % J jc221
            %     both installation has passed then SCARD_W_UNPOWERED_CARD


            \subsection{\texttt{referencelocation}}
            Now we get to more interesting results (from the perspective of the attack). Again, we will first present the cards, that prevented the attacks. As previously, the \vulnscap could not have been loaded with the error \shortswwrongdata for the cards \Dcard, \Fcard, \Gcard, \Hcard, \Inewcard (for SDKs 2.2.1.--3.0.5u3). The cards \Cnewcard behaved like that as well, but returned the status word \shortswunknown.
        
        Again, the card \Ccard reacted a bit differently --- allowed the load, but gave \shortswconditionsnotsatisfied during the installation of \vulnscap. The card \Icard behaved exactly like that (for all SDKs also).
        The situation for the card \Jcard is bit more complicated. For SDKs 3.0.5u1--3.0.5u3 the installation of \vulnscap passed, but then loading of \appletscap failed with unknown error \mintinline{python}{0x6438}. For SDK 2.2.1. both installations succeeded, but during the send stage \mintinline{python}{GETFIELD_A} the card stopped working with \scardenottransacted. For the rest of the SDKs the card behaved similarly, but instead of stopping it gave the status word \shortswinsnotsupported.

    Finally, the card \Acard was susceptible to the attack. However, not for all SDKs --- the versions 3.0.5.u1--3.0.5u3 prevented the load of \appletscap with \shortswwrongdata. But for SDKs 2.2.1.--3.0.4. all the stages of the attack succeeded with the exception of uninstall stages. For some unknown reason the applets cannot be uninstalled anymore and attempts to do so return \shortswconditionsnotsatisfied. However, when we have executed the attack again, but without all the send stages, then both applets were uninstalled without a problem. Therefore the send stages must cause something in the JCVM, that prevents the uninstallation.

    The overview of the results for referencelocation attack is in the table~\ref{tab:best-referencelocation}.
    % \import{src/tables/subtables}{best-referencelocation.tex}


        % Anew jc221, jc222, jc303, jc304
        %     success all the way!, but can't delete any applet
        %     DELETE failed: 0x6985 (Conditions of use not satisfied)
        %     jc305u1u2u3
        %         applets.cap: LOAD failed: 0x6A80 (Wrong data/incorrect values in data)
        % B no
        % C jc221, jc222, jc303, jc304, jc305u1u2u3
        %     vulns.new.cap
        %     INSTALL [for load] failed: 0x6985 (Conditions of use not satisfied
        % Cnew jc221, jc222, jc303, jc304, jc305u1u2u3
        %     vulns.new.cap LOAD failed: 0x6F00
        % D jc221, jc222, jc303, jc304, jc305u1u2u3
        %     vulns.new.cap
        %     LOAD failed: 0x6A80 (Wrong data/incorrect values in data
        % E no
        % F jc221, jc222, jc303, jc304, jc305u1u2u3
        %     vulns.new.cap
        %     LOAD failed: 0x6A80 (Wrong data/incorrect values in data
        % G jc221, jc222, jc303, jc304, jc305u1u2u3
        %     vulns.new.cap
        %     LOAD failed: 0x6A80 (Wrong data/incorrect values in data
        
        % H jc221, jc222, jc303, jc304, jc305u1u2u3
        %     vulns.new.cap
        %     LOAD failed: 0x6A80 (Wrong data/incorrect values in data
        % I jc221, jc222, jc303, jc304, jc305u1u2u3
        %     vulns.new.cap
        %     INSTALL [for load] failed: 0x6985 (Conditions of use not satisfied

        % Inew jc221, jc222, jc303, jc304, jc305u1u2u3
        %     vulns.new.cap
        %     LOAD failed: 0x6A80 (Wrong data/incorrect values in data
        % J  jc221
        %     both install ok
        %     first send SCARD_E_NOT_TRANSACTED
        %     applets.cap uninstall failed with 6985
        %     vulns.new.cap uninstall ok
        %    jc222
        %     both install ok
        %     send returned
        %     6d00 ins value not supported sw_ins_not_supported
        %     uninstall ok
        %    jc303
        %     both install ok
        %     send returned
        %     6d00 ins value not supported sw_ins_not_supported
        %     uninstall ok
        %    jc304
        %     both install ok
        %     send returned
        %     6d00 ins value not supported sw_ins_not_supported
        %     uninstall ok
        %   jc305u1u2u3
        %     vulns.new.cap ok
        %     applets.cap though LOAD failed: 0x6438


    \subsection{\texttt{staticfield_ref}}

            We will continue with another successful attack. The cards \Gcard (for all SDKs) prevented already the loading of \vulnscap returning an unknown value \mintinline{python}{0x6484}. The cards \Icard and \Ccard allowed the loading of \vulnscap, but stopped during the installation with \shortswconditionsnotsatisfied.

            The card \Cnewcard (for all SDKs) failed to load the CAP file \appletscap with status word \shortswconditionsnotsatisfied. The card \Dcard (tested only for 2.2.1) also allowed the installation of \vulnscap, but stopped working right after with \scardwunresponsivecard (this error has not been observed elsewhere).

            The attack proceeded a bit further for the card \Inewcard. For SDK 2.2.1. both installations succeeded, but then the first send stage \mintinline{python}{GET_STATIC} returned \shortswunknown. However, for the rest of the SDKs the attack returned \shortswconditionsnotsatisfied while loading the \appletscap.

            The cards \Fcard, \Hcard behaved in the exact same way. For the SDK versions 3.0.3.--3.0.5.u3 the loading of \appletscap failed with status word \shortswwrongdata. However, for the rest of the SDKs 2.2.1. and 2.2.2. all attack stages have succeeded.

            The attack worked also against the card \Jcard for the version 2.2.1. For SDKs 2.2.2.--3.0.4. the installations passed, but then the send stage failed with \shortswinsnotsupported. For 3.0.5.u1--3.0.5u3 already the loading of \appletscap returned the unknown status word \mintinline{python}{0x6438}.

        Finally, we get to the card \Acard. The newer SDKs 3.0.5u1--3.0.5u3 prevented the load of \appletscap with now the usual \shortswwrongdata. For the rest of the SDKs 2.2.1.--3.0.4., however, all stages have passed and the attack was successful.

        The reader can see the results in concise manner in the table~\ref{tab:best-staticfield_ref}.

        % \import{src/tables/subtables}{best-staticfield-ref.tex}

        % Anew 221, 222, 303, 304 all passed
            % jc305u1u2u3
            % applets.cap LOAD failed: 0x6A80 (Wrong data/incorrect values in data

        % B nothing
        % C all sdks
        %     vulns.new.cap INSTALL [for load] failed: 0x6985 (Conditions of use not satisfied
        % Cnew all sdks
        %     applets.cap LOAD failed: 0x6985 (Conditions of use not satisfied)
        % D jc221 vulnscap install ok, but SCARD_W_UNRESPONSIVE_CARD after
        % E no
        % F jc221, jc222 all passed!
        %     jc303, jc304, jc305u1u2u3
        %     applets.cap LOAD failed: 0x6A80 (Wrong data/incorrect values in data
        %     uninstall ok though

        % G all sdks
        %     vulns.new.cap
        %     LOAD failed: 0x6484 (<-- unknown value)

        % H jc221, jc222, all passed
        %     jc303, 304, jc305u1u2u3
        %     applets.cap LOAD failed: 0x6A80 (Wrong data/incorrect values in data

        % I all sdks
        %     vulns.new.cap INSTALL [for load] failed: 0x6985 (Conditions of use not satisfied

        % Inew jc221
        %     installs ok
        %     first send 6F00 No precise diagnosis SW_UNKNOWN
            % rest of sdks
            % applets.cap LOAD failed: 0x6985 (Conditions of use not satisfied

        % J jc221 works!
            % jc222, jc303, jc304
            %     installs ok, first send 6D00 INS value not supported SW_INS_NOT_SUPPORTED
            % jc305u1u2u3
            %     second install applets.cap LOAD failed: 0x6438

        \subsection{\texttt{swap_x}}\label{subsec:swapx}
        % TODO add \xspace to the custom mintinlines

            Four cards allowed all attack stages as the reader can see in the table~\ref{tab:best-swap_x}.
        % TODO align the card an SDK to the top in the table?
            % \import{src/tables/subtables}{best-swap-x.tex}

            The card \Gcard prevented the loading of \vulnscap for all SDKs and returned the unknown status word \mintinline{python}{0x6484}. For the cards \Ccard and \Icard the attack got a bit further and failed during the installation of \vulnscap with the error \shortswconditionsnotsatisfied, regardless of the SDK.

%TODO TRIGGER_SWAPX did overflow, fix, breaklines and breakafter did not work
            Again, the \Cnewcard (for all SDKs) behaved differently and let the \vulnscap to be installed, but failed during the loading of \appletscap and gave \shortswconditionsnotsatisfied. The card \Acard installed both applets successfully for SDK 2.2.1., but while sending the \mintinline{python}{TRIGGER_SWAPX} the card stopped working with \scardwunpoweredcard. Other SDKs were not tested.

        The card \Dcard could not load the \appletscap for SDKs 2.2.2--3.0.5u1 and returned the status word \shortswwrongdata, moreover, for 3.0.5u1 the card stopped working with \scardenottransacted. Only for the SDK 2.2.1. both applets were installed and the attack failed during the execution of the send stage with \shortswclanotsupported.


    Now we are moving on to the cards, that could not prevent the attack completely. As observed previously, the cards \Fcard and \Hcard behaved in the exact same way. For the SDKs 3.0.3.--3.0.5u3 the loading of \appletscap failed with \shortswwrongdata, however, the for other versions 2.2.1. and 2.2.2. the attack worked completely. The card \Inewcard did react only slightly differently. The attack has succeeded for SDK 2.2.2. and failed for the rest while loading the \appletscap, but this time the returned status word was \shortswconditionsnotsatisfied.

    Finally, the situation with the \Jcard. Again, the oldest SDK version 2.2.1. did allow the attack to pass all of the stages. For the SDK versions 2.2.2.--3.0.4. both applets were installed, but the send staged resulted in the error word \shortswinsnotsupported. For the rest of the SDKs 3.0.5u1--3.0.5u3 the attack did not go further than installing the \vulnscap and failed during the loading of \appletscap with the unknown status word \mintinline{python}{0x6438}.

            % Anew jc221
            %     installs ok
            %     first send SCARD_W_UNPOWERED_CARD
            % B nothing
            % C all sdks
            %     vulns.new.cap
            %         INSTALL [for load] failed: 0x6985 (Conditions of use not satisfied
            % Cnew
            %     applets.cap
            %         LOAD failed: 0x6985 (Conditions of use not satisfied
            %     uninstall ok
            % D jc221
            %    install, uninstall ok
            %         first send 6e00
            %     jc222, jc303, jc304
            %         applets.cap LOAD failed: 0x6A80 (Wrong data/incorrect values in data
            %     jc305u1
            %         applets.cap LOAD failed: 0x6A80 (Wrong data/incorrect values in data)
            %         resulted in SCARD_E_NOT_TRANSACTED

            % E nothing
            % F jc221, jc222 works
            %   jc303, jc304, jc305u1u2u3 applets.cap LOAD failed: 0x6A80 (Wrong data/incorrect values in data
            % G all sdks
            %     vulns.new.cap LOAD failed: 0x6484

            % H jc221, jc222 works
            %   jc303, jc304, jc305u1u2u3 applets.cap LOAD failed: 0x6A80 (Wrong data/incorrect values in data
            % I all skds
            %     vulns.new.cap INSTALL [for load] failed: 0x6985 (Conditions of use not satisfied)

            % Inew jc221 pass
            %     rest sdks applets.cap LOAD failed: 0x6985 (Conditions of use not satisfied
            % J jc221 pass
            %     jc222, jc303, jc304
            %         installs ok, first send 6D00 INS value not supported SW_INS_NOT_SUPPORTED
            %     jc305u1u2u3
            %         second install applets.cap LOAD failed: 0x6438

        % \subsection{stack_underflow}
        %     Not implemented :(
    \subsection{\texttt{transaction_confusion}}

            The reader can see the results for himself in the table~\ref{tab:best-transaction_confusion}. Unfortunately, due to a mistake during the research this attack was not built for the SDK 2.1.2. version, so the following results are excluding this version, even if the mentioned SDK ranges would include it.

            The attack has failed during the loading of \transactionconfusioncap file on the card \Acard for SDKs 3.0.5u1--3.1.0b43 with the status word \shortswwrongdata. For the remaining SDKs 2.1.1.--3.0.4. the installation has passed, but the send stage \mintinline{python}{INS_PREPARE1} has failed with \shortswunknown status word.

            The card \Bcard prevented the attack during the loading of the \transactionconfusioncap CAP file for the SDK versions 3.0.4.--3.1.0b43 and gave \shortswwrongdata. For the rest of the SDKs 2.1.1.--3.0.3. the attack passed the installation stage and failed during the first send stage with \shortswwrongdata.
        
        We don't have any results for the card \Ccard, but for the \Cnewcard the applet file failed to load for all of the SDKs from 2.2.1. to 3.0.5u3 with the error \shortswconditionsnotsatisfied and similarly for 3.1.0b43, but the card returned \shortswunknown. Only for 2.1.1. the attack passed the installation and failed while sending the \mintinline{python}{INS_PREPARE2} APDU with \shortswunknown.

        The next card \Dcard failed while loading the CAP file with \shortswwrongdata (for SDKs 2.2.2.--3.1.0b43). For the versions 2.1.1. and 2.2.1. the CAP file was installed successfully, but the subsequent send stage returned \shortswwrongdata.

        For the card \Gcard the installation failed during the loading with the unknown status word \mintinline{python}{0x6484} for 2.1.1.--3.0.5u3 and with \shortswwrongdata for the last SDK 3.1.0b43. Similarly, for the card \Icard the attack did not pass through the installation stage and failed while loading with \shortswconditionsnotsatisfied for all SDK versions.

        The following cards were left till the end as on all of them the attack at some point resulted in the \scardenottransacted error. For the card \Fcard for version 2.1.1. the installation passed and even selection of the applet succeeded for the \mintinline{python}{INS_PREPARE1} stage, however, the actual send of the stage resulted in \scardenottransacted. Further SDKs were not tested.

        The attack failed to load the \transactionconfusioncap file and returned \shortswwrongdata on card \Hcard (for SDKs 3.0.3.--3.1.0b43). For the rest of the versions 2.1.1.--2.2.2. the installation and selection of the applet passed, but the send stage then failed with \scardenottransacted.

        Lastly, the behaviour of \Inewcard was somewhat similar to behaviour of the previous card. For the SDKs 2.2.2.--3.1.0b43 already the loading of the applet has failed with \shortswconditionsnotsatisfied. and for both of the reamining SDKs 2.1.1.--2.2.1. the installation and selection passed, but then the send resulted in \scardenottransacted.


            % FIXME 212 version not called
            % Stopped card
            % Anew jc211 - jc304
            %         install ok, send 6f00 SW_UNKNOWN
            %     jc305u1u2u3, jc310b43
            %         install LOAD failed: 0x6A80 (Wrong data/incorrect values in data

            % B jc211 -jc303 first send 6A80 Wrong data SW_WRONG_DATA
            %     jc304 - rest LOAD failed: 0x6A80 (Wrong data/incorrect values in data)
            % C none
            % Cnew  jc211,
            %         second send 6F00 No precise diagnosis SW_UNKNOWN

                % jc221, jc222, j303, jc304, jc305u1u2u3
                %     install LOAD failed: 0x6985 (Conditions of use not satisfied
                % jc310b43
                %     install LOAD failed: 0x6F00 SW_UNKNOWN

            % D jc211, jc221
            %     send returned 6A80 Wrong data SW_WRONG_DATA
            %     jc222 - jc310b43
            %         LOAD failed: 0x6A80 (Wrong data/incorrect values in data
            % E nothing
            % F jc211
            %     applet selection ok, but first send gave SCARD_E_NOT_TRANSACTED
            %     rest not called
            % G
            %     all except jc310b43 
            %         on instal LOAD failed: 0x6484
            %     jc310b43
            %         on insall 0x6A80 (Wrong data/incorrect values in data

            % H jc211, jc221, jc222
            %         install ok, select ok, first send gave
            %         send SCARD_E_NOT_TRANSACTED
            %     rest
            %         LOAD failed: 0x6A80 (Wrong data/incorrect values in data

            % I
            %     all sdks
            %     INSTALL [for load] failed: 0x6985 (Conditions of use not satisfied

            % Inew
            %     jc211
            %         install ok, select ok,  send SCARD_E_NOT_TRANSACTED
            %     jc221
            %         install ok, select ok,  send SCARD_E_NOT_TRANSACTED
            %     jc222 -jc310b43
            %         install LOAD failed: 0x6985 (Conditions of use not satisfied)   

\setlength{\tabcolsep}{.5pt}
\renewcommand{\arraystretch}{.20}
\setlength{\floatsep}{0pt}

\begin{table}[htb!]
    \captionsetup{font=footnotesize}
    \parbox[b][][b]{.45\linewidth}{
        \input{src/tables/subtables/best-arraycopy.tex}
    }
    \hfill
    \parbox[b][][b]{.45\linewidth}{
        \input{src/tables/subtables/best-arrayops.tex}
    }
\end{table}
\begin{table}[htb!]
    \captionsetup{font=footnotesize}
    \parbox[b][][b]{.45\linewidth}{
        \input{src/tables/subtables/best-baload-bastore.tex}
    }
    \hfill
    \parbox[b][][b]{.45\linewidth}{
        \input{src/tables/subtables/best-nativemethod.tex}
    }
\end{table}
\begin{table}[htb!]
    \captionsetup{font=footnotesize}
    \parbox[b][][b]{.45\linewidth}{
        \input{src/tables/subtables/best-referencelocation.tex}
    }
    \hfill
    \parbox[b][][b]{.45\linewidth}{
        \input{src/tables/subtables/best-staticfield-ref.tex}
    }
\end{table}
\begin{table}[htb!]
    \captionsetup{font=footnotesize}
    \parbox[b][][b]{.45\linewidth}{
        \input{src/tables/subtables/best-swap-x.tex}
    }
    \hfill
    \parbox[b][][b]{.45\linewidth}{
        \input{src/tables/subtables/best-transaction-confusion.tex}
    }
\end{table}
\setlength{\tabcolsep}{\oldtabcolsep}
\renewcommand{\arraystretch}{1.2}

        \subsection{Overall results}
            % We have presented several results in the previous sections, that differed quite a bit, but were of similar nature.
        To give the reader an overview across all the cards and all the attacks we present them once more in a single table~\ref{tab:results-overview}. The SDK version in the table represents the newest SDK for which the given attack POC has worked. What is reassuring is the fact, that the currently oldest attack registered in JavaCard Vulnerabilty Scanner the \texttt{transaction_confusion} did not work on any of the cards. However, the \Jcard even though it is not the newest is only few years old and was vulnerable to three out of eight attacks.
    
        We will further look into the attacks to see, if they can used to retrieve and alter different memory regions, as is suggested in~\cite{se:oracle:part1}.

            % TODO make the header of the table nicer!!
\setlength{\tabcolsep}{2pt}
\renewcommand{\arraystretch}{1.2}

            \import{src/tables/subtables}{results-overview.tex}

\setlength{\tabcolsep}{\oldtabcolsep}
\renewcommand{\arraystretch}{1.2}
\setlength{\floatsep}{\oldtabcolsep}
